define(["require","exports","./sectionbuilder"],function(n,t,i){"use strict";function k(n){return n=n.replace(/</g,"&lt;"),n.replace(/>/g,"&gt;")}function d(n){var u,f,e,t;switch(n){case"text":u=new i.TextContent;u.text="text";r.content.push(u);break;case"code":f=new i.CodeContent;f.text="<p>code<\/p>";r.content.push(f);break;case"sample":e=new i.ExampleContent;e.text="<p>code example<\/p>";r.content.push(e);break;case"img":t=new i.ImageContent;t.path="file://D:/Pictures/Texturen/bee.jpg";t.alt="missing image!";r.content.push(t)}}function g(n){var t,u,f,l;r=i.SectionBuilder.fromJS(n);t=new i.TextContent;e=$("."+t.constructor.name)[0].innerHTML;u=new i.CodeContent;o=$("."+u.constructor.name)[0].innerHTML;f=new i.ExampleContent;s=$("."+f.constructor.name)[0].innerHTML;l=new i.ImageContent;h=$("."+l.constructor.name)[0].innerHTML;c=$(".content-control")[0].innerHTML}function nt(){$("#json").val(r.toJSON())}function l(n){var t=v(n),i,u,f;t>0&&t<r.content.length&&(i=$("#Content"+t),u=$("#Content"+(t-1)),i.after(u),i.attr("id","Content"+(t-1)),u.attr("id","Content"+t),f=r.content[t],r.content[t]=r.content[t-1],r.content[t-1]=f)}function a(n){var t=v(n),i,u,f;t>=0&&t<r.content.length-1&&(i=$("#Content"+t),u=$("#Content"+(t+1)),i.before(u),i.attr("id","Content"+(t+1)),u.attr("id","Content"+t),f=r.content[t],r.content[t]=r.content[t+1],r.content[t+1]=f)}function u(){var n=function(n){var l=$("#col"),r,c;for(l.length==0&&(l=$('<div class="col" id="col"><\/div>')),$("#container").append(l),r=0;r<n.length;r++){var t=n[r],u="Content"+r,a=$("#"+u);a.length==0?t instanceof i.ExampleContent?(c=f(r,s,l),w(c,t,u)):t instanceof i.CodeContent?(c=f(r,o,l),y(c,t,u)):t instanceof i.TextContent?(c=f(r,e,l),p(c,t,u)):t instanceof i.ImageContent&&(c=f(r,h,l),b(c,t,u)):t instanceof i.ExampleContent?w(a,t,u):t instanceof i.CodeContent?y(a,t,u):t instanceof i.TextContent?p(a,t,u):t instanceof i.ImageContent&&b(a,t,u)}};n(r.content)}function v(n){return parseInt(n.attr("id").match(/\d*$/)[0])}function f(n,t,i){var r=$(t),u=$(c),f;return r.attr("id","Content"+n),f=r.find(".edit"),f.hide(0),u.find(".edit-btn").click(function(){f.toggle()}),u.find(".up").click(function(){l(r)}),u.find(".down").click(function(){a(r)}),r.append(u),i.append(r),r}function y(n,t){var f=n.find("code").first(),i,r,e;return f.attr("class",t.type),f.html(k(t.text)),i=n.find(".text-edit"),i.text(t.text),r=n.find(".type-edit"),r.val(t.type),e=n.find(".save-btn"),e.click(function(){t.text=i.val().toString();t.type=r.val().toString();u()}),n}function p(n,t){n.find("p").first().text(t.text).text(t.text);var i=n.find(".text-edit"),r=n.find(".save-btn");return i.val(t.text),r.click(function(){t.text=i.val().toString();u()}),n}function w(n,t){var i,r;return n.find(".sample").first().html(t.text),i=n.find(".text-edit"),i.val(t.text),r=n.find(".save-btn"),r.click(function(){t.text=i.val().toString();u()}),n}function b(n,t){function o(n,t){var i=new FileReader;i.onload=function(){var n=new XMLHttpRequest;n.responseType="text";n.open("POST",window.location.href+"/AddImage");n.onload=function(){alert(n.response);t.path=n.response;u()};n.send("name:test.png;"+i.result)};i.readAsDataURL(n)}var r=n.find("img").first(),i,f,e;return r.attr("src",t.path),r.attr("alt",t.alt),i=n.find(".alt-edit"),i.val(t.alt),f=n.find(".src-edit"),e=n.find(".save-btn"),e.click(function(){t.alt=i.val().toString();var n=f.prop("files")[0];o(n,t)}),n}t.__esModule=!0;var e,o,s,h,c,r;t.create=d;t.init=g;t.save=nt;t.up=l;t.down=a;t.draw=u});